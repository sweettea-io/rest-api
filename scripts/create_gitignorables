#!/bin/bash

# --- Create files/dirs that were gitignored and should now exist --- #

ENV_DIR="envs"
EXAMPLES_DIR="$ENV_DIR/examples"

declare -a dirs=(
	"bin/"
	"$ENV_DIR"
	"$ENV_DIR/test/"
	"$ENV_DIR/local/"
	"$ENV_DIR/dev/"
	"$ENV_DIR/staging/"
	"$ENV_DIR/prod/"
)

# Upsert dirs
for dir in "${dirs[@]}"; do
	if [[ ! -d "$dir" ]]; then
		echo "Creating directory $dir"
		mkdir "$dir"
	fi
done
e
# Copy example.env into local/.env
if [[ ! -f "$ENV_DIR/local/.env" ]]; then
	cp "$EXAMPLES_DIR/example.env" "$ENV_DIR/local/.env"
fi

# Copy app-specific docker env files from examples
declare -a env_example_dest=(
	"$ENV_DIR/test"
	"$ENV_DIR/local"
	"$ENV_DIR/dev"
	"$ENV_DIR/staging"
	"$ENV_DIR/prod"
)

declare -a apps=("migrate" "server" "worker")

e
	for app in "${apps[@]}"; do
		if [[ ! -f "$dest_dir/$app.env" ]]; then
			cp "$EXAMPLES_DIR/$app.example.env" "$dest_dir/$app.env"
		fi
	done
done